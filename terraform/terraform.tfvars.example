# TunnelMesh Terraform Configuration
#
# Copy this file to terraform.tfvars and customize for your deployment.

# ============================================================================
# REQUIRED
# ============================================================================

# DigitalOcean API Token - set via environment variable:
#   export TF_VAR_do_token="dop_v1_xxx"
# Get yours at: https://cloud.digitalocean.com/account/api/tokens

# Your domain name (must be managed in DigitalOcean DNS)
domain = "example.com"

# Authentication token for mesh peers
# Generate with: openssl rand -hex 32
auth_token = ""

# Authentication token for admin web interface
# Generate with: openssl rand -hex 32
admin_token = ""

# ============================================================================
# NODE DEFINITIONS
# ============================================================================
# Define your mesh infrastructure below. Each node is a key in the map.
#
# Per-node options:
#   coordinator = true/false  # Run coordination server (max 1)
#   peer        = true/false  # Run as mesh peer
#   wireguard   = true/false  # Enable WireGuard concentrator
#   region      = "ams3"      # Override default region
#   size        = "s-1vcpu-1gb"  # Override droplet size
#   wg_port     = 51820       # Override WireGuard port
#   ssh_port    = 2222        # Override SSH tunnel port
#   tags        = ["custom"]  # Additional tags
#
# Exit node options (split-tunnel VPN):
#   allow_exit_traffic = true/false  # Allow this node to be an exit node
#   exit_node          = "node-name"  # Route internet through specified peer
#
# Location options (manual GPS - overrides IP geolocation):
#   location = { latitude = 51.5, longitude = -0.12, city = "London", country = "UK" }
#
# DNS alias options (custom hostnames pointing to this node):
#   dns_aliases = ["webserver", "api.mynode"]  # Additional DNS names for this peer

# --- Example 1: All-in-One (recommended for getting started) ---
# Single $4/month droplet with everything
nodes = {
  "tunnelmesh" = {
    coordinator        = true
    peer               = true
    wireguard          = true
    allow_exit_traffic = true  # Allow clients to route internet through this node
    # dns_aliases = ["coordinator", "main"]  # Additional DNS names for this node
    # location = { latitude = 52.37, longitude = 4.90, city = "Amsterdam", country = "NL" }
  }
}

# --- Example 2: Coordinator Peer (Exit Node) + Separate WireGuard Peer ---
# nodes = {
#   "tunnelmesh" = {
#     coordinator        = true
#     peer               = true
#     allow_exit_traffic = true
#   }
#   "tm-wg" = {
#     peer      = true
#     wireguard = true
#     exit_node = "tunnelmesh"  # Route internet through coordinator
#   }
# }

# --- Example 3: Multi-Region Deployment ---
# Coordinator in Amsterdam, WireGuard peers in multiple regions
# nodes = {
#   "tunnelmesh" = {
#     coordinator = true
#     peer        = true
#     wireguard   = true
#     region      = "ams3"
#   }
#   "tm-us" = {
#     peer      = true
#     wireguard = true
#     region    = "nyc3"
#   }
#   "tm-asia" = {
#     peer      = true
#     wireguard = true
#     region    = "sgp1"
#   }
# }

# --- Example 4: Exit Node Setup (Split-Tunnel VPN) ---
# Route internet traffic through a designated exit node while keeping
# mesh traffic direct. Great for privacy or geo-unblocking.
# nodes = {
#   "tunnelmesh" = {
#     coordinator = true
#     peer        = true
#     wireguard   = true
#     region      = "ams3"
#   }
#   # This node allows other peers to route their internet through it
#   "tm-exit-sgp" = {
#     peer               = true
#     region             = "sgp1"
#     allow_exit_traffic = true  # <-- Enable as exit node
#     # Manual location (optional - overrides IP geolocation)
#     location = {
#       latitude  = 1.3521
#       longitude = 103.8198
#       city      = "Singapore"
#       country   = "Singapore"
#     }
#   }
#   # This peer routes its internet traffic through the Singapore exit
#   "tm-client" = {
#     peer      = true
#     region    = "lon1"
#     exit_node = "tm-exit-sgp"  # <-- Route internet through Singapore
#   }
# }

# --- Example 5: High Availability Setup ---
# Larger coordinator, multiple WireGuard entry points
# nodes = {
#   "tunnelmesh" = {
#     coordinator = true
#     peer        = true
#     size        = "s-1vcpu-2gb"
#     region      = "ams3"
#   }
#   "tm-wg-eu" = {
#     peer      = true
#     wireguard = true
#     region    = "fra1"
#   }
#   "tm-wg-us" = {
#     peer      = true
#     wireguard = true
#     region    = "sfo3"
#   }
# }

# --- Example 6: Peers Only (external coordinator) ---
# For connecting to an existing coordinator
# external_coordinator_url = "https://tunnelmesh.example.com"
# nodes = {
#   "tm-office" = {
#     peer      = true
#     wireguard = true
#   }
#   "tm-datacenter" = {
#     peer = true
#   }
# }

# ============================================================================
# DEFAULT SETTINGS
# ============================================================================
# These can be overridden per-node in the nodes map above

# DigitalOcean region (nyc1, nyc3, sfo2, sfo3, ams3, sgp1, lon1, fra1, tor1, blr1, syd1)
# default_region = "ams3"

# Droplet size
# default_droplet_size = "s-1vcpu-512mb-10gb"  # $4/mo

# WireGuard UDP port
# default_wg_port = 51820

# SSH tunnel port for mesh connections
# default_ssh_port = 2222

# External API HTTPS port (peers connect here, port 443 reserved for mesh admin)
# external_api_port = 8443

# ============================================================================
# GLOBAL SETTINGS
# ============================================================================

# SSH key name (from your DigitalOcean account) for droplet access
# ssh_key_name = "my-ssh-key"

# Email for Let's Encrypt SSL certificate notifications
# ssl_email = "admin@example.com"

# Mesh network CIDR
# mesh_cidr = "10.99.0.0/16"

# Domain suffix for mesh hostnames
# domain_suffix = ".tunnelmesh"

# Enable node location tracking (requires external IP geolocation API)
# WARNING: When enabled, the coordinator will query ip-api.com to geolocate nodes
# by their public IP addresses. This is disabled by default for privacy.
# locations_enabled = false

# ============================================================================
# MONITORING SETTINGS
# ============================================================================

# Enable monitoring stack (Prometheus, Grafana, Loki) on coordinator node
# Includes: Prometheus for metrics, Grafana for dashboards, Loki for logs
# monitoring_enabled = false

# Prometheus data retention in days (default: 3)
# prometheus_retention_days = 3

# Loki log retention in days (default: 3)
# loki_retention_days = 3

# ============================================================================
# AUTO-UPDATE SETTINGS
# ============================================================================

# Enable automatic updates on all nodes
# auto_update_enabled = true

# Schedule for auto-updates (systemd OnCalendar format: hourly, daily, weekly)
# auto_update_schedule = "hourly"

# GitHub owner for binary downloads
# github_owner = "zombar"

# TunnelMesh version
# binary_version = "latest"
