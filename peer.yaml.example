# =============================================================================
# TunnelMesh Peer Configuration
# =============================================================================
# This config works for both regular peers AND coordinators.
# To enable coordinator services, set coordinator.enabled: true
# =============================================================================

# Your node's unique name
name: "mynode"

# Auth token is set via TUNNELMESH_TOKEN environment variable (not in config file):
#   export TUNNELMESH_TOKEN="your-secure-token"
#   Bootstrap coordinator: tunnelmesh join
#   Join existing mesh: tunnelmesh join coord.example.com:8443

# SSH server port for peer-to-peer connections
ssh_port: 2222

# Path to SSH private key (auto-generated if missing)
private_key: "~/.tunnelmesh/id_ed25519"

# Log level: trace, debug, info, warn, error
log_level: "info"

# -----------------------------------------------------------------------------
# DNS Resolver (always enabled for all peers)
# -----------------------------------------------------------------------------
dns:
  listen: "127.0.0.53:5353"
  cache_ttl: 300
  aliases:
    - "webserver"  # Creates webserver.tunnelmesh alias

# -----------------------------------------------------------------------------
# Coordinator Services (optional, for first coordinator or additional coordinators)
# -----------------------------------------------------------------------------
# Uncomment to enable coordinator services on this peer.
# When enabled, S3, relay, and admin dashboard are automatically enabled.

# coordinator:
#   enabled: true
#   listen: ":8443"  # HTTPS listen address for peer registrations
#
#   # Admin peers (grant full admin access)
#   # Supports peer names OR peer IDs (SHA256 of SSH key, first 8 bytes = 16 hex chars)
#   # Peer IDs are preferred for security (immutable)
#   admin_peers: ["coordinator", "alice"]  # Example with names
#   # admin_peers: ["a1b2c3d4e5f6g7h8", "i9j0k1l2m3n4o5p6"]  # Example with peer IDs (recommended)
#
#   # Monitoring reverse proxy (optional)
#   # Requires Prometheus/Grafana configured with sub-path support
#   monitoring:
#     prometheus_url: "http://localhost:9090"
#     grafana_url: "http://localhost:3000"
#
#   # S3 storage configuration
#   s3:
#     max_size: "10Gi"  # Defaults to 1Gi if not set
#     data_dir: "/var/lib/tunnelmesh/s3"  # Optional
#
#   # Global packet filter (applied to all peers)
#   # filter:
#   #   default_deny: true
#   #   rules:
#   #     - port: 22
#   #       protocol: tcp
#   #       action: allow
#
#   # Service ports to auto-allow on all peers (for metrics scraping)
#   service_ports: [9443]
#
#   # Node location tracking (queries ip-api.com for geolocation)
#   locations: false

# -----------------------------------------------------------------------------
# TUN Interface
# -----------------------------------------------------------------------------
tun:
  name: "tun-mesh0"
  mtu: 1400

# -----------------------------------------------------------------------------
# Exit Node (Split-Tunnel VPN)
# -----------------------------------------------------------------------------
# exit_peer: "server-node"     # Route internet through this peer
allow_exit_traffic: false       # Allow others to use this as exit

# -----------------------------------------------------------------------------
# Local Packet Filter
# -----------------------------------------------------------------------------
# filter:
#   rules:
#     - port: 80
#       protocol: tcp
#       action: allow
