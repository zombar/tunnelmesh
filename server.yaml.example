# TunnelMesh Server Configuration
# Copy to server.yaml and modify as needed

# Listen address for the coordination server
listen: ":8080"

# Authentication token - peers must provide this to register
# Generate a secure token, e.g.: openssl rand -hex 32
auth_token: "your-secure-token-here"

# Mesh network CIDR - IP addresses assigned to peers
# Default avoids conflict with Tailscale (100.x.x.x)
mesh_cidr: "172.30.0.0/16"

# Domain suffix for mesh hostnames
domain_suffix: ".tunnelmesh"

# Log level: trace, debug, info, warn, error (default: info)
# Use "debug" or "trace" for troubleshooting, "warn" for minimal logging
# log_level: "info"

# Admin web interface configuration
# Access is controlled by bind_address (no authentication)
admin:
  enabled: true
# bind_address: "127.0.0.1"  # Default: localhost only (secure)
# port: 8080                 # Default: 8080 (or 443 with join_mesh for HTTPS)
#
# WARNING: Setting bind_address to "0.0.0.0" exposes admin WITHOUT authentication!
# For external access, use join_mesh (mesh-only HTTPS) or put behind authenticated proxy.
#
# With join_mesh configured: admin is served via HTTPS on the mesh IP only,
# accessible at https://<name>.tunnelmesh/ (or the localhost-style internal dns of https://this.tunnelmesh)
#
# Users should trust the mesh CA once by running: 
#     sudo tunnelmesh trust-ca --server http://server:8080

# WebSocket relay for peers that can't establish direct connections
relay:
  enabled: true
  pair_timeout: "90s"

# Node location tracking (shows map in admin dashboard)
# WARNING: Queries ip-api.com to geolocate nodes by public IP
locations: false

# WireGuard endpoint advertised to mobile clients (when server runs WG concentrator)
# wireguard:
#   enabled: true
#   endpoint: "server.example.com:51820"

# Server as mesh peer (all-in-one deployment)
# join_mesh:
#   name: "server-node"
#   ssh_port: 2222
#   private_key: "/etc/tunnelmesh/peer.key"
#   tun:
#     name: tun-mesh
#     mtu: 1400
#   dns:
#     enabled: true
#     listen: "127.0.0.1:5353"
#     aliases:
#       - "coordinator"
#   allow_exit_traffic: true
#     exit_node: "other-peer"
#     location:
#       latitude: 52.3676
#       longitude: 4.9041
#       city: "Amsterdam"
#       country: "Netherlands"
#     wireguard:
#       enabled: true
#       listen_port: 51820
#       data_dir: /var/lib/tunnelmesh/wireguard
#       endpoint: "server.example.com:51820"
